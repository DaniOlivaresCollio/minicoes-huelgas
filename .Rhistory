pivot_longer(everything(),
names_to = c("Variable", "Estadístico"),
names_sep = "_") %>%
pivot_wider(names_from = Estadístico, values_from = value)
desc_num <- desc_num %>%
mutate(`% categoría relevante` = NA_character_,
Tipo = "Numérica") %>%
select(Variable, Tipo, media, sd, `% categoría relevante`)
# Tabla para variables dicotómicas (0/1)
dic_vars <- c("marcha", "female", "sector")
desc_dic <- data %>%
summarise(across(all_of(dic_vars),
~mean(.x == 1, na.rm = TRUE)*100)) %>%
pivot_longer(everything(), names_to = "Variable", values_to = "% categoría relevante") %>%
mutate(Tipo = "Dicotómica",
media = NA_real_,
sd = NA_real_) %>%
select(Variable, Tipo, media, sd, `% categoría relevante`)
# Tabla para variables categóricas politómicas
cat_vars <- c("class3a", "pol_id", "ola")
desc_cat <- lapply(cat_vars, function(var) {
tab <- data %>%
filter(!is.na(.data[[var]])) %>%
count(!!sym(var)) %>%
mutate(prop = n / sum(n) * 100) %>%
arrange(desc(prop)) %>%
slice(1)
tibble(
Variable = var,
Tipo = "Categórica",
media = NA_real_,
sd = NA_real_,
`% categoría relevante` = paste0(tab[[var]], " (", round(tab$prop, 1), "%)")
)
}) %>% bind_rows()
# Unir todas las tablas
desc_final <- bind_rows(desc_num, desc_dic, desc_cat)
# Tabla para variables numéricas
num_vars <- c("brecha_just", "edad", "pol_scale", "brecha_perc",
"cambio_posible", "Meritocracy_scale")
desc_num <- data %>%
summarise(across(all_of(num_vars),
list(media = ~mean(.x, na.rm = TRUE),
sd = ~sd(.x, na.rm = TRUE)),
.names = "{.col}_{.fn}")) %>%
pivot_longer(everything(),
names_to = c("Variable", "Estadístico"),
names_sep = "_") %>%
pivot_wider(names_from = Estadístico, values_from = value)
desc_num <- desc_num %>%
mutate(`% categoría relevante` = NA_character_,
Tipo = "Numérica") %>%
select(Variable, Tipo, media, sd, `% categoría relevante`)
desc_num
data %>%
sjmisc::descr(show = c("label","range", "mean", "sd", "NA.prc", "n")) %>%
kable(.,"markdown")
View(data)
# Variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Tabla descriptiva de variables numéricas
tabla_numericas <- descr(data[, vars_numericas], stats = c("mean", "sd", "min", "max", "NA.prc"))
# Tabla descriptiva de variables numéricas
tabla_numericas <- descr(data[, vars_numericas], stats ="mean", "sd", "min", "max", "NA.prc")
# Tabla descriptiva de variables numéricas
tabla_numericas <- descr(data[, vars_numericas], stats ="mean,sd,min,max,NA.prc")
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva
tabla_numericas <- descr(
data[, vars_numericas],
stats = "mean,sd,min,max,NA.prc"  # Nota: es una cadena, no un vector
)
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(stats = "mean,sd,min,max,NA.prc")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show= c("label","mean","sd","min","max","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","min","max","NA.prc")) %>%
kable(.,"markdown")
# Ver tabla en consola
print(tabla_numericas)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","min","max","NA.prc")) %>%
kable(.,"markdown")
# Ver tabla en consola
print(tabla_numericas)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc")) %>%
kable(.,"markdown")
# Ver tabla en consola
print(tabla_numericas)
tabla_numericas
rm(list=ls())
options(scipen = 999)
library(pacman)
p_load(bookdown,
car,
flextable,
forcats,
ggrepel,
ggalluvial,
ggplot2,
gridExtra,
httr,
janitor,
kableExtra,
knitr,
labelled,
lubridate,
psych,
readr,
readxl,
shadowtext,
sjmisc,
sjPlot,
sjlabelled,
statar,
survey,
tinytex,
tidyverse,
viridis
)
data <- readRDS(here::here("input/data/elsoc_paper2.rds"))
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Convertir a flextable
tabla_ft <- flextable::flextable(tabla_numericas)
# Opcional: formato bonito
tabla_ft <- tabla_ft %>%
flextable::set_table_properties(width = 1, layout = "autofit") %>%
flextable::theme_booktabs() %>%
flextable::fontsize(size = 10, part = "all") %>%
flextable::align(align = "center", part = "all")
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
rm(list=ls())
options(scipen = 999)
library(pacman)
p_load(bookdown,
car,
flextable,
forcats,
ggrepel,
ggalluvial,
ggplot2,
gridExtra,
httr,
janitor,
kableExtra,
knitr,
labelled,
lubridate,
officer,
psych,
readr,
readxl,
shadowtext,
sjmisc,
sjPlot,
sjlabelled,
statar,
survey,
tinytex,
tidyverse,
viridis
)
data <- readRDS(here::here("input/data/elsoc_paper2.rds"))
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Convertir a flextable
tabla_ft <- flextable::flextable(tabla_numericas)
# Opcional: formato bonito
tabla_ft <- tabla_ft %>%
flextable::set_table_properties(width = 1, layout = "autofit") %>%
flextable::theme_booktabs() %>%
flextable::fontsize(size = 10, part = "all") %>%
flextable::align(align = "center", part = "all")
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
# Guardar en carpeta "output"
print(doc, target = "output/tabla_descriptiva.docx")
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Convertir a flextable
tabla_ft <- flextable::flextable(tabla_numericas)
# Opcional: formato bonito
# Convertir tabla sjmisc a flextable y aplicar estilo
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%                               # Bordes tipo libro
set_table_properties(width = 1, layout = "autofit") %>%  # Ajuste automático
fontsize(size = 10, part = "all") %>%              # Tamaño de fuente general
font(fontname = "Calibri", part = "all") %>%       # Cambiar fuente
bold(part = "header") %>%                          # Negrita en encabezado
align(align = "center", part = "all") %>%          # Centrar todo
align(j = 1, align = "left", part = "all") %>%     # Alinear etiquetas a la izquierda
padding(padding = 5, part = "all")                 # Espaciado interno
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
# Guardar en carpeta "output"
print(doc, target = "output/tabla_descriptiva_numericas.docx")
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Convertir a flextable
tabla_ft <- flextable::flextable(tabla_numericas)
# Opcional: formato bonito
# Convertir tabla sjmisc a flextable y aplicar estilo
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%                               # Bordes tipo libro
set_table_properties(width = 1, layout = "autofit") %>%  # Ajuste automático
fontsize(size = 10, part = "all") %>%              # Tamaño de fuente general
font(fontname = "Calibri", part = "all") %>%       # Cambiar fuente
bold(part = "header") %>%                          # Negrita en encabezado
align(align = "left", part = "all") %>%            # Alinear todo
align(j = 1, align = "left", part = "all") %>%     # Alinear etiquetas a la izquierda
padding(padding = 5, part = "all")                 # Espaciado interno
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
# Guardar en carpeta "output"
print(doc, target = "output/tabla_descriptiva_numericas.docx")
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Ver tabla en consola
print(tabla_numericas)
# Convertir a flextable
tabla_ft <- flextable::flextable(tabla_numericas)
# Opcional: formato bonito
# Convertir tabla sjmisc a flextable y aplicar estilo
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%                               # Bordes tipo libro
set_table_properties(width = 1, layout = "autofit") %>%  # Ajuste automático
fontsize(size = 10, part = "all") %>%              # Tamaño de fuente general
font(fontname = "Calibri", part = "all") %>%       # Cambiar fuente
bold(part = "header") %>%                          # Negrita en encabezado
align(align = "left", part = "all") %>%            # Alinear todo
align(j = 1, align = "left", part = "all") %>%     # Alinear etiquetas a la izquierda
padding(padding = 5, part = "all")                 # Espaciado interno
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
# Guardar en carpeta "output"
print(doc, target = "output/tabla_descriptiva_numericas.docx")
print(tabla_ft)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "min", "max", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# HTML o PDF
kable(tabla_numericas, format = "pipe", digits = 2)
} else {
# Word
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
tabla_ft
}
# # Crear documento Word y agregar la tabla
# doc <- officer::read_docx() %>%
#   body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
#   body_add_flextable(tabla_ft)
#
# # Guardar en carpeta "output"
# print(doc, target = "output/tabla_descriptiva_numericas.docx")
#
# print(tabla_ft)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "min", "max", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# HTML o PDF
kable(tabla_numericas, format = "pipe", digits = 2)
} else {
# Word
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
tabla_ft
}
# # Crear documento Word y agregar la tabla
# doc <- officer::read_docx() %>%
#   body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
#   body_add_flextable(tabla_ft)
#
# # Guardar en carpeta "output"
# print(doc, target = "output/tabla_descriptiva_numericas.docx")
#
# print(tabla_ft)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "min", "max", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# HTML o PDF
kable(tabla_numericas, format = "pipe", digits = 2)
} else {
# Word
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
tabla_ft
}
# # Crear documento Word y agregar la tabla
# doc <- officer::read_docx() %>%
#   body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
#   body_add_flextable(tabla_ft)
#
# # Guardar en carpeta "output"
# print(doc, target = "output/tabla_descriptiva_numericas.docx")
#
# print(tabla_ft)
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva correctamente
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label","mean","sd","range","NA.prc"))
# Tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "min", "max", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# HTML o PDF
kable(tabla_numericas, format = "pipe", digits = 2)
} else {
# Word
tabla_ft <- flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
tabla_ft
}
# Crear documento Word y agregar la tabla
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_ft)
# Guardar en carpeta "output"
print(doc, target = "output/tabla_descriptiva_numericas.docx")
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "range", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# Tabla para HTML o PDF con kable
knitr::kable(tabla_numericas, format = "pipe", digits = 2, align = "c")
} else {
# Tabla para Word con flextable
flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
}
# Definir variables numéricas
vars_numericas <- c("brecha_just", "marcha", "edad", "pol_scale",
"brecha_perc", "cambio_posible", "Meritocracy_scale")
# Crear tabla descriptiva con sjmisc
tabla_numericas <- data %>%
select(all_of(vars_numericas)) %>%
descr(show = c("label", "mean", "sd", "range", "NA.prc"))
# Mostrar tabla según formato de salida
if (knitr::is_html_output() || knitr::is_latex_output()) {
# Tabla para HTML o PDF con kable
knitr::kable(tabla_numericas, format = "pipe", digits = 2, align = "c")
} else {
# Tabla para Word con flextable
flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
}
# Crear y guardar archivo Word con la tabla
tabla_docx <- flextable(tabla_numericas) %>%
theme_booktabs() %>%
set_table_properties(width = 1, layout = "autofit") %>%
fontsize(size = 10, part = "all") %>%
font(fontname = "Calibri", part = "all") %>%
bold(part = "header") %>%
align(align = "center", part = "all") %>%
align(j = 1, align = "left", part = "all") %>%
padding(padding = 5, part = "all")
# Crear documento Word
doc <- officer::read_docx() %>%
body_add_par("Tabla descriptiva de variables numéricas", style = "heading 1") %>%
body_add_flextable(tabla_docx)
# Guardar archivo Word en carpeta output
print(doc, target = "output/tabla_descriptiva.docx")
